version: 2

models:
  # Original marketplace mart model
  - name: mart_marketplace__customer_kpis
    description: "Customer-level marketplace KPIs including searches, leads, and revenue"
    # Using a custom test for uniqueness of the combination
    # tests:
    #   - unique:
    #       column_name: customer_id
    #   - unique:
    #       column_name: report_date
    columns:
      - name: report_date
        description: "Date for which the KPIs are reported"
        tests:
          - not_null
      - name: customer_id
        description: "Unique identifier for the customer"
        tests:
          - not_null
      - name: marketplace_searches
        description: "Total number of marketplace searches by the customer"
        tests:
          - not_null
      - name: marketplace_leads
        description: "Total number of marketplace leads (zero-eligibility + regular)"
      - name: marketplace_revenue
        description: "Total revenue generated from marketplace leads"
      - name: marketplace_leads_regular
        description: "Number of regular marketplace leads"
      - name: marketplace_revenue_regular
        description: "Revenue from regular marketplace leads"
      - name: marketplace_leads_zero_elig
        description: "Number of zero eligibility marketplace leads"
      - name: marketplace_revenue_zero_elig
        description: "Revenue from zero eligibility marketplace leads"
      - name: marketplace_searches_car_finance
        description: "Number of car finance searches"
      - name: marketplace_searches_car_re_finance
        description: "Number of car refinance searches"
      - name: marketplace_searches_creditcard
        description: "Number of credit card searches"
      - name: marketplace_searches_loan
        description: "Number of loan searches"

  # New customer engagement mart models
  - name: mart_customer_360
    description: "Comprehensive 360-degree view of each customer across all data sources"
    tests:
      - unique:
          column_name: customer_id
    columns:
      - name: customer_id
        description: "Unique identifier for the customer"
        tests:
          - not_null
      - name: first_subscription_date
        description: "Date of the customer's first subscription"
      - name: total_days_as_customer
        description: "Total number of days since first subscription"
      - name: total_months_as_customer
        description: "Total number of months since first subscription"
      - name: customer_tenure_segment
        description: "Segment based on customer tenure (New, Recent, Engaged, Loyal)"
      - name: current_subscription_id
        description: "ID of current active subscription, if any"
      - name: current_plan_type
        description: "Type of current plan, if any (Basic, Premium)"
      - name: current_plan_tier
        description: "Tier of current plan, if any (Bronze, Silver, Gold, Platinum)"
      - name: current_tier_level
        description: "Numerical level of current tier, if any"
      - name: current_monthly_fee
        description: "Monthly fee of current subscription, if any"
      - name: active_percentage
        description: "Percentage of total customer days that had active subscriptions"
      - name: total_referrals_made
        description: "Total number of referrals made by this customer"
      - name: successful_referrals
        description: "Number of referrals that converted successfully"
      - name: total_referral_bonus_earned
        description: "Total bonus amount earned from referrals"
      - name: first_referral_date
        description: "Date of customer's first referral"
      - name: last_referral_date
        description: "Date of customer's most recent referral"
      - name: referrals_last_3_months
        description: "Number of referrals made in the last 3 months"
      - name: is_referred_customer
        description: "Flag indicating if this customer was referred by someone else"
      - name: date_referred
        description: "Date when this customer was referred, if applicable"
      - name: referred_by_customer_id
        description: "ID of the customer who referred this person, if applicable"
      - name: referrer_segment
        description: "Segment based on referral activity (Non-referrer, Referrer, Advocate, Champion)"
      - name: is_active_referrer
        description: "Flag indicating if customer has made referrals in the last 3 months"
      - name: marketplace_total_searches
        description: "Total marketplace searches by this customer"
      - name: marketplace_total_leads
        description: "Total marketplace leads generated by this customer"
      - name: marketplace_total_revenue
        description: "Total marketplace revenue generated by this customer"
      - name: marketplace_last_activity_date
        description: "Date of customer's last marketplace activity"
      - name: marketplace_active_days
        description: "Number of days the customer had marketplace activity"
      - name: marketplace_creditcard_searches
        description: "Number of credit card searches by this customer"
      - name: marketplace_loan_searches
        description: "Number of loan searches by this customer"
      - name: marketplace_car_finance_searches
        description: "Number of car finance searches by this customer"
      - name: marketplace_car_refinance_searches
        description: "Number of car refinance searches by this customer"
      - name: marketplace_regular_leads
        description: "Number of regular leads generated by this customer"
      - name: marketplace_zero_elig_leads
        description: "Number of zero eligibility leads generated by this customer"
      - name: marketplace_regular_revenue
        description: "Revenue from regular leads generated by this customer"
      - name: marketplace_zero_elig_revenue
        description: "Revenue from zero eligibility leads generated by this customer"
      - name: eligible_for_premium_upgrade
        description: "Flag indicating if customer is eligible for premium plan upgrade"
      - name: eligible_for_tier_upgrade
        description: "Flag indicating if customer is eligible for tier upgrade"
      - name: eligible_for_exclusive_offers
        description: "Flag indicating if customer is eligible for exclusive offers"
      - name: eligible_for_premium_creditcard
        description: "Flag indicating if customer is eligible for premium credit card offers"
      - name: eligible_for_preferred_loan_rates
        description: "Flag indicating if customer is eligible for preferred loan rates"
      - name: cross_sell_score
        description: "Overall score for cross-sell potential (0-100)"
      - name: customer_value_segment
        description: "Segment based on overall customer value (Standard, Mid-Value, High-Value, VIP)"
      - name: activity_status
        description: "Current activity status (Active, Recent, Lapsed, Inactive)"
      - name: updated_at
        description: "Timestamp when this record was last updated"

  - name: mart_customer_retention
    description: "Customer retention metrics and churn risk analysis"
    tests:
      - unique:
          column_name: customer_id
    columns:
      - name: customer_id
        description: "Unique identifier for the customer"
        tests:
          - not_null
      - name: latest_subscription_id
        description: "ID of the customer's most recent subscription"
      - name: latest_plan_type
        description: "Plan type of the most recent subscription"
      - name: latest_plan_tier
        description: "Plan tier of the most recent subscription"
      - name: latest_subscription_start
        description: "Start date of the most recent subscription"
      - name: latest_subscription_end
        description: "End date of the most recent subscription"
      - name: latest_subscription_status
        description: "Status of the most recent subscription"
      - name: latest_monthly_fee
        description: "Monthly fee of the most recent subscription"
      - name: first_subscription_date
        description: "Date of the customer's first subscription"
      - name: customer_tenure_segment
        description: "Segment based on customer tenure"
      - name: total_months_as_customer
        description: "Total months since first subscription"
      - name: total_subscriptions
        description: "Total number of subscriptions the customer has had"
      - name: number_of_churns
        description: "Number of times the customer has churned"
      - name: last_churn_date
        description: "Date of the customer's most recent churn"
      - name: avg_days_between_churns
        description: "Average number of days between multiple churns"
      - name: marketplace_total_searches
        description: "Total marketplace searches by this customer"
      - name: marketplace_total_leads
        description: "Total marketplace leads generated by this customer"
      - name: marketplace_last_activity_date
        description: "Date of customer's last marketplace activity"
      - name: marketplace_active_days
        description: "Number of days the customer had marketplace activity"
      - name: activity_status
        description: "Current activity status (Active, Recent, Lapsed, Inactive)"
      - name: active_percentage
        description: "Percentage of total customer days that had active subscriptions"
      - name: days_since_last_activity
        description: "Number of days since the customer's last activity"
      - name: days_until_renewal
        description: "Number of days until the current subscription renews"
      - name: churn_risk_score
        description: "Score indicating the risk of churn (0-100, higher = greater risk)"
      - name: churn_risk_category
        description: "Categorization of churn risk (Low Risk, Medium Risk, High Risk, Churned)"
      - name: recommended_retention_action
        description: "Recommended action to reduce churn risk"
      - name: updated_at
        description: "Timestamp when this record was last updated"